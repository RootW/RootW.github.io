---
layout: post
title: 计算机
date: 2017-02-05 
tags: 自顶向下分析计算机系统
---

&emsp;&emsp;作为**自顶向下分析计算机系统**的开篇，我们先抛开一些底层实现的细节，先从顶层理解什么是计算机？为什么我们需要它？然后再深入一层看看计算机内部整体的组成结构。

### 什么是计算机？

&emsp;&emsp;我们每个人都有个人电脑(PC, Personal Computer)，可以想象一下，你的电脑正在你的面前。首先，我们都知道通常它是由显示器、鼠标、键盘和主机组成的。当你按下电源键打开电脑后，如果你想在电脑中保存一些内容，你会把光标移动到word程序图标之上，并通过双击鼠标左键打开这个程序；之后你可以在程序的窗口中输入你想保存的东西，比如通过键盘输入"hello,world!"；接着通过菜单栏中的保存按钮你可以确认期望保存的文件位置，比如/root/hello.txt；如果一切顺利，那么当你再次打开这个文件的时候，你会看到里面的内容还是"hello,world!"。又或者你想借助电脑进行一些数值运算，这时你会打开计算器程序，在里面输入你想计算的算式，比如"1+1"；当前点击等号按钮时，你就会得到你想要的计算结果，比如这里就是2。再或者你想给远方的朋友发个问候，你只需要打开即时通信程序，选择你的好友之后，输入你想说的话，点击发送之后你的好友就会在他的电脑上看到你发送的消息。如果你想在工作的时候听听音乐，也未尝不可，你只需要打开音乐播放器后选择你想听的歌曲，当你回到工作程序时，你的电脑会保持工作程序和音乐播放器同时运行，两者不会有影响。当然，如果你和我一样，也是一个程序员的话，也可以完全不必受限于电脑中已有的程序：打开代码编辑器，输入你想要的代码，编译，运行，想要什么功能就有什么功能(简直就是上帝:-))。

&emsp;&emsp;上面这些既是大家所熟悉的使用场景，也涵盖了机算机的核心概念：从物理视角上看，它的结构包含输入输出设备和主机；它的使用过程是，首先使用者通过输入设备向主机传递命令和信息，接着主机基于内部状态并结合命令和输入信息可以计算出输出结果或改变内部状态，最后主机通过输出设备将计算结果或内部状态传递给使用者；从功能视角上看，它提供了以存储、计算、网络通信为基础的各种功能，这些功能不但可以并行化以提升效率，而且可以通过编程的方式组合扩展出更多丰富的功能。

### 为什么需要计算机？

&emsp;&emsp;计算机提供的存储、计算和网络功能就像七巧板一样，可以拼装出各色各样鲜活漂亮的图案，所以理论上，它可以满足人们所有的信息化需求(信息获取、状态改变)，取代大量的脑力劳动，成为人类最忠实的助手。通常它在需求的满足方式上有通用和专用两种：

&emsp;&emsp;通用计算机(例如我们的个人电言月子)的优点在于它的灵活性，通过优化已有软件或部署新的软件，可以让已有系统更好地满足用户新的需求。但它也有缺点，通用系统需要采用通用的硬件设计和通用的操作系统内核，而通用的硬件设计针对特定功能无法将性能发挥到极致，同样通用的操作系统内核需要考虑应用软件之间的隔离性、安全性和兼容性，这就意味着系统软件的复杂性大大提高。专用计算机(例如网络交换机)则正好相反，它的优点在于系统性能高、软件复杂度低，缺点则在于功能不灵活，不易扩展。

&emsp;&emsp;因此，大型计算系统的设计中往往没有绝对的通用和绝对的专用，而是从用户对系统的述求出发，在通用和专用之间寻找一个平衡点：将性能要求不高的功能交给系统通用部分去完成，而将性能要求较高的功能卸载到专用硬件完成，通用和专用相互配合对外提供高效、灵活的功能。

### 如何实现计算机？

&emsp;&emsp;在自项向下的分析方法中，每当我们深入一个系统(或一个部件)内部时，就会看到一些子系统，包括它们的结构和工作过程(回答子系统是什么)，以及它们相互之间是如何配合以完成系统整体功能的(回答为什么需要这个子系统)，这就是自顶向下方法的精髓所在。

&emsp;&emsp;对于计算机系统来说，这里我以intel x86架构下经典的i440fx系统为例来展示其内部组成，来看一幅我的手绘图：

<div align="center">
    <img src="/images/posts/i440fx/i440fx.jpg" height="400" width="500">  
</div> 

&emsp;&emsp;图中从上往下看，整个i440fx系统中的设备包含：CPU（图中画了两个逻辑核示意）、北桥（PMC, PCI and Memory Controller）、显卡（AGP）、内存、南桥（PIIX3, PCI IDE ISA Accelerator）、PCI插槽和设备（如网卡、存储Raid卡控制器等）。另外，i440fx属多核体系，其中断部分包含LAPIC（Local Advanced Programmable Interrupt Controller，每个逻辑CPU包含一个）和IOAPIC（Input/Output Advanced Programmable Interrupt Controller，集成在PIIX3南桥中）两部分。除了设备，系统中还包含连接设备的各类总线：FSB（Front Side Bus，连接CPU和北桥）、PCI总线（Peripheral Component Interconnect，连接南北桥和所有的PCI设备）、IDE总线（“Integrated Drive Electronics，连接南桥中IDE控制器和传统IDE硬盘）、USB（Universal Serial Bus，连接USB控制器和USB设备）、ISA总线（Industry Standard Architecture，连接南桥ISA控制器和传统ISA设备，如鼠标和键盘；传统ISA总线采用两片级联的8259A芯片作为中断控制器直连单核CPU的INTR引脚，在i440fx中为了兼容老的单核操作系统仍保留了该功能，但是现代多核操作系统已不使用8259A芯片，而采用IOAPIC进行中断通知，详细内容可参考后续中断相关博文）。

&emsp;&emsp;CPU和内存完成系统核心的计算和管理功能，构成了计算子系统（也称核心子系统）；各类存储控制器完成数据的存取，构成了存储子系统；网卡设备完成网络报文的收发，构成了网络子系统。由此可见，不仅大型系统可区分计算、存储、网络三大子系统，就连基本的计算机单元内部，也可划分出计算、存储、网络三个部分。

&emsp;&emsp;在这篇博文里，暂不对计算机的各个子系统都进行全面的分析。后续将分篇对计算、存储和网络子系统分别进行分析，自上而下、层层深入。愿自己能有更多的时间学习、总结和分享，enjoy hacking the system~

<br>
转载请注明：[吴斌的博客](https://rootw.github.io) » [计算机](https://rootw.github.io/2017/02/计算机/) 
