---
layout: post
title: 计算子系统-开篇与目录
date: 2017-02-11
tags: 自顶向下分析计算机系统 计算子系统
---

&emsp;&emsp;计算子系统是整个计算系统的核心，从本篇博文起将对该核心系统进行一系列深入分析。

### 什么是计算子系统？

&emsp;&emsp;在前篇对计算机系统的内部实现进行简要说明时，我们讨论过计算子系统。在单核架构下，内存是负责存储程序(指令的集合)和数据的部件，CPU则根据程序对数据进行读取、运算和写回，并对外部设备进行控制，我们通过编写程序来控制CPU实现具体功能。在多核架构下，系统变得复杂了：内存被多个**进程**共享，每个进程仍然包含**代码**和**数据**两个部分，并且每个进程都认为自己独占了整个内存地址空间，相互之间并不直接感知，由执行的CPU(MMU，Memory Management Unit)进行**内存地址转换**；每个CPU在同一时刻只能执行一个进程，并通过进程进行**数据计算**和**外设控制**等核心功能，而当外设处理完成CPU发起的请求后会以**中断**的方式通知CPU；此外CPU还需要负责进程的**创建**、**替换**、**终止**、**调度**、**通信(间接感知)**等一系列动作。下图是多核架构下CPU&Memory的状态示意图，需要补充说明的是进程内存空间分为用户空间和内核空间两部分(图中未画出)：每个部分均包含代码和数据两个部分，用户空间是进程独立的，用来实现各自独特的功能，但内核空间是所有进程共享的，用来实现全局性的或系统性的功能；用户空间程序需要访问内核空间的功能函数时需要通过系统调用完成。

<div align="center">
    <img src="/images/posts/i440fx/cpu.jpg" height="400" width="500">  
</div> 

### 为什么需要计算子系统？

&emsp;&emsp;计算子系统是计算机内部最为复杂的系统，如上一部分所述，它包含了内存管理(地址转换、空间分配、空间回收等)、进程执行(完成数据计算、外设控制等核心功能，以及系统调用切换等系统过程)、进程管理(创建、替换、终止、调度、通信)、中断处理、内核同步等一系列过程。

&emsp;&emsp;我们回顾一下前篇所描述的使用word程序进行文档保存的场景来看看计算子系统是如何发挥作用的：移动光标并双击图标时，鼠标会将这此操作转换成事件并通过**中断**通知CPU；CPU进入中断处理逻辑捕获这些事件后交由SHELL程序进行解析；SHELL解析得知用户期望运行word程序，接着通过**系统调用**来**创建**一个新的进程；CPU在时钟的驱使下开始**调度**执行新创建的word进程，进程运行初期由于并未分配可用的内存会产生缺页**异常**；CPU在异常处理过程中为进程**分配内存**并进行**地址映射**，完成后便重新进行进程的执行；该进程正常运行时首先会**通知**SHELL程序需要在显示器上生成一个新窗口；新窗口产生后，word进程便可以捕获用户的输入；用户完成输入以后，点按保存按钮进行保存时SHELL再次**通知**word进程发生了保存事件，word进程便会调用系统存储接口**向存储设备发起存储请求**，word进程自身则进入**睡眠**状态；存储设备存储完成后，通过**中断**通知CPU，CPU便会**唤醒**word进程再次进入可编辑状态。

&emsp;&emsp;由此可见，每一个使用场景中，计算子系统作为核心系统不断地在发挥它们的作用，它们是用户操作的直接响应者，离开了它们，即使存储和网络设备正常，也无法完成任何系统功能。

### 如何实现计算子系统？

&emsp;&emsp;计算子系统涵盖了如此丰富的功能，我们需要从不同的功能视角来观察和理解它们，才能形成更加全面的认识。因此后续博文将从内存管理、进程管理、系统调用、中断处理等多个方面来分析该系统：


*[内存管理]
*[系统调用](https://rootw.github.io/2017/02/系统调用/)


&emsp;&emsp;针对功能的深入分析，其实也是对计算子系统物理工作过程的深入理解。功能分析时，我们可以借助高级语言来表达分析过程(这里我们主要以C语言并结合linux 3.10内核来理解核心子系统的实现)。然而，当分析深入到一定程度时，高级语言可能无法细致地表达某些系统过程，此时我们就需要通过汇编语言(AT&T语法)来描述系统内部的寄存器及其操作过程。本质上来说，高级语言所描述的功能最终也是转化成汇编来实现的，因此掌握汇编语言是深入理解系统一个必不可少的技能。这里我们先对CPU内部寄存器及内存布局设计做一个总体描绘，它们的内部结构如下图所示：

<div align="center">
    <img src="/images/posts/i440fx/cpu_low_level.jpg" height="550" width="400">  
</div> 

&emsp;&emsp;对于AT&T汇编语法和intel x86_64架构原理，网上应该有不少资源供大家学习，这里暂不作全面介绍，后续分析时如果涉及将会补充一些说明。

<br>
转载请注明：[吴斌的博客](https://rootw.github.io) » [计算子系统-开篇与目录](https://rootw.github.io/2017/02/计算子系统/) 
